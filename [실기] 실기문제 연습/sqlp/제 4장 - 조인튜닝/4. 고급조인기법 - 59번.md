# 4. 고급조인기법 - 59번

**기록 ✍️**

#### author : jung yuha

#### **first Registered : 2022-06-29**

#### last modified : **2022-06-29**

## **\[1]** 문제 <a href="#undefined" id="undefined"></a>

\
문제 출처 : SQLP 자격검정 핵심노트1 P.174

<figure><img src="https://velog.velcdn.com/images/yooha9621/post/f3d275a7-d26b-46f4-a021-aeb01a89f310/image.png" alt=""><figcaption></figcaption></figure>

아래 데이터 모델에서 장비구분코드가 'A001'인 장비의 최종(=현재) 상태코드 , 변경일자 , 변경순번을 출력하는 최적 SQL을 작성하세요.

* 장비구분코드 ='A001'인 장비는 10건이다.
* 결과집합을 장비번호 순으로 정렬한다.
* 장비 테이블의 최종변경일시는 상태코드 변경과 무관하다.
* 상태변경이력은 선분이력 테이블이다.

### \[1] 인덱스 구성 <a href="#1" id="1"></a>

* 장비\_PK : 장비번호
* 장비\_X1 : 장비구분코드
* 상태변경이력\_PK : 장비번호 + 유효종료일시 + 유효시작일시

## \[2] 풀이

### 1) 쿼리 튜닝 <a href="#1" id="1"></a>

#### 1. 장비 테이블 액세스 <a href="#1" id="1"></a>

* 조회조건 중 장비구분코드 = 'A001'이 적용될 수 있도록 선두컬럼이 장비구분코드인 장비\_X1 인덱스를 사용한다.
* 드라이빙 테이블로 들어간다.\


#### 2. 상태변경이력 테이블 액세스 <a href="#2" id="2"></a>

* 조회 조건으로 '장비번호'를 선두로 하고 상태변경이력\_PK 인덱스를 사용해 유효시작일자와 유효종료일자 사이에 SYSDATE가 있는 데이터를 찾아 NL조인한다.

### 2) 튜닝한 SQL문 <a href="#2-sql" id="2-sql"></a>

```sql
SELECT P.장비번호 , P.장비명 , A.상태코드 AS 최종상태코드
, TO_CHAR(A.유효시작일시,'YYYYMMDD') AS 최종상태변경일자
FROM 장비 P , 상태변경이력 A
WHERE P.장비구분코드 = 'A001'
AND A.장비번호 = P.장비번호
AND P.유효시작일자 <= SYSDATE
AND P.유효종료일자 > SYSDATE
ORDER BY P.장비번호;
```

> **🍎 정리**
>
> * 얘는 앞서 푼 문제처럼 변경일자, 변경 순번으로 비교하지 못한다.
> * 장비구분코드가 'A0001' 인 장비 데이터를 드라이빙 테이블로 놓고 장비번호로 상태변경이력 테이블과 조인하는데 조인하는 데이터의 유효시작일자와 유효종료일자 사이에 현재 날짜가 있는 데이터를 NL조인한다.
